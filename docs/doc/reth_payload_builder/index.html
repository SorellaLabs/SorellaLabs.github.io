<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="This crate defines abstractions to create and update payloads (blocks):"><title>reth_payload_builder - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-e883e87179a81222.css"><meta name="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="reth_payload_builder" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-nightly (de686cbc6 2023-12-14)" data-channel="nightly" data-search-js="search-874d56868bf05518.js" data-settings-js="settings-fe03fdc259827cd2.js" ><script src="../static.files/storage-bc37acceda91d44a.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-77dede896d6ac08e.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="icon" href="https://avatars0.githubusercontent.com/u/97369466?s=256"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../reth_payload_builder/index.html"><img src="https://raw.githubusercontent.com/paradigmxyz/reth/main/assets/reth-docs.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../reth_payload_builder/index.html"><img src="https://raw.githubusercontent.com/paradigmxyz/reth/main/assets/reth-docs.png" alt="logo"></a><h2><a href="../reth_payload_builder/index.html">reth_payload_builder</a><span class="version">0.1.0-alpha.14</span></h2></div><div class="sidebar-elems"><ul class="block">
            <li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">reth_payload_builder</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../src/reth_payload_builder/lib.rs.html#1-120">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>This crate defines abstractions to create and update payloads (blocks):</p>
<ul>
<li><a href="trait.PayloadJobGenerator.html" title="trait reth_payload_builder::PayloadJobGenerator"><code>PayloadJobGenerator</code></a>: a type that knows how to create new jobs for creating payloads based
on <a href="../reth_rpc_types/eth/engine/payload/struct.PayloadAttributes.html" title="struct reth_rpc_types::eth::engine::payload::PayloadAttributes"><code>PayloadAttributes</code></a>.</li>
<li><a href="trait.PayloadJob.html" title="trait reth_payload_builder::PayloadJob"><code>PayloadJob</code></a>: a type that yields (better) payloads over time.</li>
</ul>
<p>This crate comes with the generic <a href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService"><code>PayloadBuilderService</code></a> responsible for managing payload
jobs.</p>
<h3 id="node-integration"><a href="#node-integration">Node integration</a></h3>
<p>In a standard node the <a href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService"><code>PayloadBuilderService</code></a> sits downstream of the engine API, or rather
the component that handles requests from the consensus layer like <code>engine_forkchoiceUpdatedV1</code>.</p>
<p>Payload building is enabled if the forkchoice update request contains payload attributes.</p>
<p>See also <a href="https://github.com/ethereum/execution-apis/blob/6709c2a795b707202e93c4f2867fa0bf2640a84f/src/engine/shanghai.md#engine_forkchoiceupdatedv2">the engine API docs</a>
If the forkchoice update request is <code>VALID</code> and contains payload attributes the
<a href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService"><code>PayloadBuilderService</code></a> will create a new <a href="trait.PayloadJob.html" title="trait reth_payload_builder::PayloadJob"><code>PayloadJob</code></a> via the given <a href="trait.PayloadJobGenerator.html" title="trait reth_payload_builder::PayloadJobGenerator"><code>PayloadJobGenerator</code></a>
and start polling it until the payload is requested by the CL and the payload job is resolved
(see <a href="trait.PayloadJob.html#tymethod.resolve" title="method reth_payload_builder::PayloadJob::resolve"><code>PayloadJob::resolve</code></a>).</p>
<h3 id="example"><a href="#example">Example</a></h3>
<p>A simple example of a <a href="trait.PayloadJobGenerator.html" title="trait reth_payload_builder::PayloadJobGenerator"><code>PayloadJobGenerator</code></a> that creates empty blocks:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>std::future::Future;
<span class="kw">use </span>std::pin::Pin;
<span class="kw">use </span>std::task::{Context, Poll};
<span class="kw">use </span>reth_payload_builder::{EthBuiltPayload, KeepPayloadJobAlive, EthPayloadBuilderAttributes, PayloadJob, PayloadJobGenerator};
<span class="kw">use </span>reth_payload_builder::error::PayloadBuilderError;
<span class="kw">use </span>reth_primitives::{Block, Header, U256};

<span class="doccomment">/// The generator type that creates new jobs that builds empty blocks.
</span><span class="kw">pub struct </span>EmptyBlockPayloadJobGenerator;

<span class="kw">impl </span>PayloadJobGenerator <span class="kw">for </span>EmptyBlockPayloadJobGenerator {
    <span class="kw">type </span>Job = EmptyBlockPayloadJob;

<span class="doccomment">/// This is invoked when the node receives payload attributes from the beacon node via `engine_forkchoiceUpdatedV1`
</span><span class="kw">fn </span>new_payload_job(<span class="kw-2">&amp;</span><span class="self">self</span>, attr: EthPayloadBuilderAttributes) -&gt; <span class="prelude-ty">Result</span>&lt;<span class="self">Self</span>::Job, PayloadBuilderError&gt; {
        <span class="prelude-val">Ok</span>(EmptyBlockPayloadJob{ attributes: attr,})
    }

}

<span class="doccomment">/// A [PayloadJob] that builds empty blocks.
</span><span class="kw">pub struct </span>EmptyBlockPayloadJob {
  attributes: EthPayloadBuilderAttributes,
}

<span class="kw">impl </span>PayloadJob <span class="kw">for </span>EmptyBlockPayloadJob {
   <span class="kw">type </span>PayloadAttributes = EthPayloadBuilderAttributes;
   <span class="kw">type </span>ResolvePayloadFuture = futures_util::future::Ready&lt;<span class="prelude-ty">Result</span>&lt;EthBuiltPayload, PayloadBuilderError&gt;&gt;;
   <span class="kw">type </span>BuiltPayload = EthBuiltPayload;

<span class="kw">fn </span>best_payload(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;EthBuiltPayload, PayloadBuilderError&gt; {
    <span class="comment">// NOTE: some fields are omitted here for brevity
    </span><span class="kw">let </span>payload = Block {
        header: Header {
            parent_hash: <span class="self">self</span>.attributes.parent,
            timestamp: <span class="self">self</span>.attributes.timestamp,
            beneficiary: <span class="self">self</span>.attributes.suggested_fee_recipient,
            ..Default::default()
        },
        ..Default::default()
    };
    <span class="kw">let </span>payload = EthBuiltPayload::new(<span class="self">self</span>.attributes.id, payload.seal_slow(), U256::ZERO);
    <span class="prelude-val">Ok</span>(payload)
}

<span class="kw">fn </span>payload_attributes(<span class="kw-2">&amp;</span><span class="self">self</span>) -&gt; <span class="prelude-ty">Result</span>&lt;EthPayloadBuilderAttributes, PayloadBuilderError&gt; {
    <span class="prelude-val">Ok</span>(<span class="self">self</span>.attributes.clone())
}

<span class="kw">fn </span>resolve(<span class="kw-2">&amp;mut </span><span class="self">self</span>) -&gt; (<span class="self">Self</span>::ResolvePayloadFuture, KeepPayloadJobAlive) {
       <span class="kw">let </span>payload = <span class="self">self</span>.best_payload();
       (futures_util::future::ready(payload), KeepPayloadJobAlive::No)
    }
}

<span class="doccomment">/// A [PayloadJob] is a a future that's being polled by the `PayloadBuilderService`
</span><span class="kw">impl </span>Future <span class="kw">for </span>EmptyBlockPayloadJob {
 <span class="kw">type </span>Output = <span class="prelude-ty">Result</span>&lt;(), PayloadBuilderError&gt;;

<span class="kw">fn </span>poll(<span class="self">self</span>: Pin&lt;<span class="kw-2">&amp;mut </span><span class="self">Self</span>&gt;, cx: <span class="kw-2">&amp;mut </span>Context&lt;<span class="lifetime">'_</span>&gt;) -&gt; Poll&lt;<span class="self">Self</span>::Output&gt; {
        Poll::Pending
    }
}</code></pre></div>
<h3 id="feature-flags"><a href="#feature-flags">Feature Flags</a></h3>
<ul>
<li><code>test-utils</code>: Export utilities for testing</li>
</ul>
</div></details><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="database/index.html" title="mod reth_payload_builder::database">database</a></div><div class="desc docblock-short">Database adapters for payload building.</div></li><li><div class="item-name"><a class="mod" href="error/index.html" title="mod reth_payload_builder::error">error</a></div><div class="desc docblock-short">Error types emitted by types or implementations of this crate.</div></li><li><div class="item-name"><a class="mod" href="noop/index.html" title="mod reth_payload_builder::noop">noop</a></div><div class="desc docblock-short">A payload builder service task that does nothing.</div></li></ul><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.EthBuiltPayload.html" title="struct reth_payload_builder::EthBuiltPayload">EthBuiltPayload</a></div><div class="desc docblock-short">Contains the built payload.</div></li><li><div class="item-name"><a class="struct" href="struct.EthPayloadBuilderAttributes.html" title="struct reth_payload_builder::EthPayloadBuilderAttributes">EthPayloadBuilderAttributes</a></div><div class="desc docblock-short">Container type for all components required to build a payload.</div></li><li><div class="item-name"><a class="struct" href="struct.OptimismPayloadBuilderAttributes.html" title="struct reth_payload_builder::OptimismPayloadBuilderAttributes">OptimismPayloadBuilderAttributes</a></div><div class="desc docblock-short">Optimism Payload Builder Attributes</div></li><li><div class="item-name"><a class="struct" href="struct.PayloadBuilderHandle.html" title="struct reth_payload_builder::PayloadBuilderHandle">PayloadBuilderHandle</a></div><div class="desc docblock-short">A communication channel to the <a href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService">PayloadBuilderService</a>.</div></li><li><div class="item-name"><a class="struct" href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService">PayloadBuilderService</a></div><div class="desc docblock-short">A service that manages payload building tasks.</div></li><li><div class="item-name"><a class="struct" href="struct.PayloadId.html" title="struct reth_payload_builder::PayloadId">PayloadId</a></div><div class="desc docblock-short">And 8-byte identifier for an execution payload.</div></li><li><div class="item-name"><a class="struct" href="struct.PayloadStore.html" title="struct reth_payload_builder::PayloadStore">PayloadStore</a></div><div class="desc docblock-short">A communication channel to the <a href="struct.PayloadBuilderService.html" title="struct reth_payload_builder::PayloadBuilderService">PayloadBuilderService</a> that can retrieve payloads.</div></li></ul><h2 id="enums" class="section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.KeepPayloadJobAlive.html" title="enum reth_payload_builder::KeepPayloadJobAlive">KeepPayloadJobAlive</a></div><div class="desc docblock-short">Whether the payload job should be kept alive or terminated after the payload was requested by
the CL.</div></li></ul><h2 id="traits" class="section-header"><a href="#traits">Traits</a></h2><ul class="item-table"><li><div class="item-name"><a class="trait" href="trait.PayloadJob.html" title="trait reth_payload_builder::PayloadJob">PayloadJob</a></div><div class="desc docblock-short">A type that can build a payload.</div></li><li><div class="item-name"><a class="trait" href="trait.PayloadJobGenerator.html" title="trait reth_payload_builder::PayloadJobGenerator">PayloadJobGenerator</a></div><div class="desc docblock-short">A type that knows how to create new jobs for creating payloads.</div></li></ul></section></div></main></body></html>