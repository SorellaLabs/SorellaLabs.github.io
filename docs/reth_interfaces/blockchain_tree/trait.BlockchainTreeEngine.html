<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="BlockchainTreeEngine::insert_block: Connect block to chain, execute it and if valid insert block inside tree.BlockchainTreeEngine::finalize_block: Remove chains that join to now finalized block, as chain becomes invalid.BlockchainTreeEngine::make_canonical: Check if we have the hash of block that we want to finalize and commit it to db. If we don’t have the block, syncing should start to fetch the blocks from p2p. Do reorg in tables if canonical chain if needed."><title>BlockchainTreeEngine in reth_interfaces::blockchain_tree - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-e883e87179a81222.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="reth_interfaces" data-themes="" data-resource-suffix="" data-rustdoc-version="1.76.0-nightly (de686cbc6 2023-12-14)" data-channel="nightly" data-search-js="search-874d56868bf05518.js" data-settings-js="settings-fe03fdc259827cd2.js" ><script src="../../static.files/storage-bc37acceda91d44a.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-77dede896d6ac08e.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-5d8b3c7633ad77ba.css"></noscript><link rel="icon" href="https://avatars0.githubusercontent.com/u/97369466?s=256"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../reth_interfaces/index.html"><img src="https://raw.githubusercontent.com/paradigmxyz/reth/main/assets/reth-docs.png" alt=""></a></nav><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../reth_interfaces/index.html"><img src="https://raw.githubusercontent.com/paradigmxyz/reth/main/assets/reth-docs.png" alt="logo"></a><h2><a href="../../reth_interfaces/index.html">reth_interfaces</a><span class="version">0.1.0-alpha.14</span></h2></div><h2 class="location"><a href="#">BlockchainTreeEngine</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.buffer_block">buffer_block</a></li><li><a href="#tymethod.connect_buffered_blocks_to_canonical_hashes">connect_buffered_blocks_to_canonical_hashes</a></li><li><a href="#tymethod.connect_buffered_blocks_to_canonical_hashes_and_finalize">connect_buffered_blocks_to_canonical_hashes_and_finalize</a></li><li><a href="#tymethod.finalize_block">finalize_block</a></li><li><a href="#tymethod.insert_block">insert_block</a></li><li><a href="#tymethod.make_canonical">make_canonical</a></li><li><a href="#tymethod.unwind">unwind</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.buffer_block_without_senders">buffer_block_without_senders</a></li><li><a href="#method.insert_block_without_senders">insert_block_without_senders</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In reth_interfaces::blockchain_tree</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">reth_interfaces</a>::<wbr><a href="index.html">blockchain_tree</a>::<wbr><a class="trait" href="#">BlockchainTreeEngine</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#17-101">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait BlockchainTreeEngine: <a class="trait" href="trait.BlockchainTreeViewer.html" title="trait reth_interfaces::blockchain_tree::BlockchainTreeViewer">BlockchainTreeViewer</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Required methods
    fn <a href="#tymethod.buffer_block" class="fn">buffer_block</a>(
        &amp;self,
        block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlockWithSenders.html" title="struct reth_primitives::block::SealedBlockWithSenders">SealedBlockWithSenders</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.insert_block" class="fn">insert_block</a>(
        &amp;self,
        block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlockWithSenders.html" title="struct reth_primitives::block::SealedBlockWithSenders">SealedBlockWithSenders</a>,
        validation_kind: <a class="enum" href="enum.BlockValidationKind.html" title="enum reth_interfaces::blockchain_tree::BlockValidationKind">BlockValidationKind</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="enum.InsertPayloadOk.html" title="enum reth_interfaces::blockchain_tree::InsertPayloadOk">InsertPayloadOk</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.finalize_block" class="fn">finalize_block</a>(&amp;self, finalized_block: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>);
<span class="item-spacer"></span>    fn <a href="#tymethod.connect_buffered_blocks_to_canonical_hashes_and_finalize" class="fn">connect_buffered_blocks_to_canonical_hashes_and_finalize</a>(
        &amp;self,
        last_finalized_block: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>
    ) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.connect_buffered_blocks_to_canonical_hashes" class="fn">connect_buffered_blocks_to_canonical_hashes</a>(&amp;self) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.make_canonical" class="fn">make_canonical</a>(
        &amp;self,
        block_hash: &amp;<a class="type" href="../../alloy_primitives/aliases/type.BlockHash.html" title="type alloy_primitives::aliases::BlockHash">BlockHash</a>
    ) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="enum" href="enum.CanonicalOutcome.html" title="enum reth_interfaces::blockchain_tree::CanonicalOutcome">CanonicalOutcome</a>&gt;;
<span class="item-spacer"></span>    fn <a href="#tymethod.unwind" class="fn">unwind</a>(&amp;self, unwind_to: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;;

    // Provided methods
    fn <a href="#method.insert_block_without_senders" class="fn">insert_block_without_senders</a>(
        &amp;self,
        block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlock.html" title="struct reth_primitives::block::SealedBlock">SealedBlock</a>,
        validation_kind: <a class="enum" href="enum.BlockValidationKind.html" title="enum reth_interfaces::blockchain_tree::BlockValidationKind">BlockValidationKind</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="enum.InsertPayloadOk.html" title="enum reth_interfaces::blockchain_tree::InsertPayloadOk">InsertPayloadOk</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.buffer_block_without_senders" class="fn">buffer_block_without_senders</a>(
        &amp;self,
        block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlock.html" title="struct reth_primitives::block::SealedBlock">SealedBlock</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt; { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><ul>
<li><a href="trait.BlockchainTreeEngine.html#tymethod.insert_block" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::insert_block">BlockchainTreeEngine::insert_block</a>: Connect block to chain, execute it and if valid insert
block inside tree.</li>
<li><a href="trait.BlockchainTreeEngine.html#tymethod.finalize_block" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::finalize_block">BlockchainTreeEngine::finalize_block</a>: Remove chains that join to now finalized block, as
chain becomes invalid.</li>
<li><a href="trait.BlockchainTreeEngine.html#tymethod.make_canonical" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::make_canonical">BlockchainTreeEngine::make_canonical</a>: Check if we have the hash of block that we want to
finalize and commit it to db. If we don’t have the block, syncing should start to fetch the
blocks from p2p. Do reorg in tables if canonical chain if needed.</li>
</ul>
</div></details><h2 id="required-methods" class="section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.buffer_block" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#45">source</a><h4 class="code-header">fn <a href="#tymethod.buffer_block" class="fn">buffer_block</a>(
    &amp;self,
    block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlockWithSenders.html" title="struct reth_primitives::block::SealedBlockWithSenders">SealedBlockWithSenders</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;</h4></section></summary><div class="docblock"><p>Buffer block with senders</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.insert_block" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#54-58">source</a><h4 class="code-header">fn <a href="#tymethod.insert_block" class="fn">insert_block</a>(
    &amp;self,
    block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlockWithSenders.html" title="struct reth_primitives::block::SealedBlockWithSenders">SealedBlockWithSenders</a>,
    validation_kind: <a class="enum" href="enum.BlockValidationKind.html" title="enum reth_interfaces::blockchain_tree::BlockValidationKind">BlockValidationKind</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="enum.InsertPayloadOk.html" title="enum reth_interfaces::blockchain_tree::InsertPayloadOk">InsertPayloadOk</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;</h4></section></summary><div class="docblock"><p>Inserts block with senders</p>
<p>The <code>validation_kind</code> parameter controls which validation checks are performed.</p>
<p>Caution: If the block was received from the consensus layer, this should always be called
with <a href="enum.BlockValidationKind.html#variant.Exhaustive" title="variant reth_interfaces::blockchain_tree::BlockValidationKind::Exhaustive">BlockValidationKind::Exhaustive</a> to validate the state root, if possible to adhere to
the engine API spec.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.finalize_block" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#61">source</a><h4 class="code-header">fn <a href="#tymethod.finalize_block" class="fn">finalize_block</a>(&amp;self, finalized_block: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>)</h4></section></summary><div class="docblock"><p>Finalize blocks up until and including <code>finalized_block</code>, and remove them from the tree.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.connect_buffered_blocks_to_canonical_hashes_and_finalize" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#74-77">source</a><h4 class="code-header">fn <a href="#tymethod.connect_buffered_blocks_to_canonical_hashes_and_finalize" class="fn">connect_buffered_blocks_to_canonical_hashes_and_finalize</a>(
    &amp;self,
    last_finalized_block: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>
) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Reads the last <code>N</code> canonical hashes from the database and updates the block indices of the
tree by attempting to connect the buffered blocks to canonical hashes.</p>
<p><code>N</code> is the maximum of <code>max_reorg_depth</code> and the number of block hashes needed to satisfy the
<code>BLOCKHASH</code> opcode in the EVM.</p>
<h5 id="note"><a href="#note">Note</a></h5>
<p>This finalizes <code>last_finalized_block</code> prior to reading the canonical hashes (using
<a href="trait.BlockchainTreeEngine.html#tymethod.finalize_block" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::finalize_block"><code>BlockchainTreeEngine::finalize_block</code></a>).</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.connect_buffered_blocks_to_canonical_hashes" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#84">source</a><h4 class="code-header">fn <a href="#tymethod.connect_buffered_blocks_to_canonical_hashes" class="fn">connect_buffered_blocks_to_canonical_hashes</a>(&amp;self) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Reads the last <code>N</code> canonical hashes from the database and updates the block indices of the
tree by attempting to connect the buffered blocks to canonical hashes.</p>
<p><code>N</code> is the maximum of <code>max_reorg_depth</code> and the number of block hashes needed to satisfy the
<code>BLOCKHASH</code> opcode in the EVM.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.make_canonical" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#97">source</a><h4 class="code-header">fn <a href="#tymethod.make_canonical" class="fn">make_canonical</a>(&amp;self, block_hash: &amp;<a class="type" href="../../alloy_primitives/aliases/type.BlockHash.html" title="type alloy_primitives::aliases::BlockHash">BlockHash</a>) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="enum" href="enum.CanonicalOutcome.html" title="enum reth_interfaces::blockchain_tree::CanonicalOutcome">CanonicalOutcome</a>&gt;</h4></section></summary><div class="docblock"><p>Make a block and its parent chain part of the canonical chain by committing it to the
database.</p>
<h5 id="note-1"><a href="#note-1">Note</a></h5>
<p>This unwinds the database if necessary, i.e. if parts of the canonical chain have been
re-orged.</p>
<h5 id="returns"><a href="#returns">Returns</a></h5>
<p>Returns <code>Ok</code> if the blocks were canonicalized, or if the blocks were already canonical.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="tymethod.unwind" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#100">source</a><h4 class="code-header">fn <a href="#tymethod.unwind" class="fn">unwind</a>(&amp;self, unwind_to: <a class="type" href="../../alloy_primitives/aliases/type.BlockNumber.html" title="type alloy_primitives::aliases::BlockNumber">BlockNumber</a>) -&gt; <a class="type" href="../type.RethResult.html" title="type reth_interfaces::RethResult">RethResult</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>&gt;</h4></section></summary><div class="docblock"><p>Unwind tables and put it inside state</p>
</div></details></div><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.insert_block_without_senders" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#22-31">source</a><h4 class="code-header">fn <a href="#method.insert_block_without_senders" class="fn">insert_block_without_senders</a>(
    &amp;self,
    block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlock.html" title="struct reth_primitives::block::SealedBlock">SealedBlock</a>,
    validation_kind: <a class="enum" href="enum.BlockValidationKind.html" title="enum reth_interfaces::blockchain_tree::BlockValidationKind">BlockValidationKind</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="enum" href="enum.InsertPayloadOk.html" title="enum reth_interfaces::blockchain_tree::InsertPayloadOk">InsertPayloadOk</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;</h4></section></summary><div class="docblock"><p>Recover senders and call <a href="trait.BlockchainTreeEngine.html#tymethod.insert_block" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::insert_block"><code>BlockchainTreeEngine::insert_block</code></a>.</p>
<p>This will recover all senders of the transactions in the block first, and then try to insert
the block.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.buffer_block_without_senders" class="method"><a class="src rightside" href="../../src/reth_interfaces/blockchain_tree/mod.rs.html#37-42">source</a><h4 class="code-header">fn <a href="#method.buffer_block_without_senders" class="fn">buffer_block_without_senders</a>(
    &amp;self,
    block: <a class="struct" href="../../reth_primitives/block/struct.SealedBlock.html" title="struct reth_primitives::block::SealedBlock">SealedBlock</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a>, <a class="struct" href="error/struct.InsertBlockError.html" title="struct reth_interfaces::blockchain_tree::error::InsertBlockError">InsertBlockError</a>&gt;</h4></section></summary><div class="docblock"><p>Recover senders and call <a href="trait.BlockchainTreeEngine.html#tymethod.buffer_block" title="method reth_interfaces::blockchain_tree::BlockchainTreeEngine::buffer_block"><code>BlockchainTreeEngine::buffer_block</code></a>.</p>
<p>This will recover all senders of the transactions in the block first, and then try to buffer
the block.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../trait.impl/reth_interfaces/blockchain_tree/trait.BlockchainTreeEngine.js" async></script></section></div></main></body></html>