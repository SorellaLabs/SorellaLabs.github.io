<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `/Users/user/.cargo/registry/src/index.crates.io-6f17d22bba15001f/malachite-base-0.4.4/src/num/arithmetic/mod_mul.rs`."><title>mod_mul.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../../static.files/rustdoc-5bc39a1768837dd0.css"><meta name="rustdoc-vars" data-root-path="../../../../" data-static-root-path="../../../../static.files/" data-current-crate="malachite_base" data-themes="" data-resource-suffix="" data-rustdoc-version="1.78.0-nightly (b11fbfbf3 2024-02-03)" data-channel="nightly" data-search-js="search-dd67cee4cfa65049.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../../static.files/storage-4c98445ec4002617.js"></script><script defer src="../../../../static.files/src-script-e66d777a5a92e9b2.js"></script><script defer src="../../../../src-files.js"></script><script defer src="../../../../static.files/main-48f368f3872407c8.js"></script><noscript><link rel="stylesheet" href="../../../../static.files/noscript-04d5337699b92874.css"></noscript><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc src"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="src-sidebar-title">
            <h2>Files</h2></div></nav><div class="sidebar-resizer"></div>
    <main><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../../malachite_base/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="example-wrap"><div data-nosnippet><pre class="src-line-numbers"><a href="#1" id="1">1</a>
<a href="#2" id="2">2</a>
<a href="#3" id="3">3</a>
<a href="#4" id="4">4</a>
<a href="#5" id="5">5</a>
<a href="#6" id="6">6</a>
<a href="#7" id="7">7</a>
<a href="#8" id="8">8</a>
<a href="#9" id="9">9</a>
<a href="#10" id="10">10</a>
<a href="#11" id="11">11</a>
<a href="#12" id="12">12</a>
<a href="#13" id="13">13</a>
<a href="#14" id="14">14</a>
<a href="#15" id="15">15</a>
<a href="#16" id="16">16</a>
<a href="#17" id="17">17</a>
<a href="#18" id="18">18</a>
<a href="#19" id="19">19</a>
<a href="#20" id="20">20</a>
<a href="#21" id="21">21</a>
<a href="#22" id="22">22</a>
<a href="#23" id="23">23</a>
<a href="#24" id="24">24</a>
<a href="#25" id="25">25</a>
<a href="#26" id="26">26</a>
<a href="#27" id="27">27</a>
<a href="#28" id="28">28</a>
<a href="#29" id="29">29</a>
<a href="#30" id="30">30</a>
<a href="#31" id="31">31</a>
<a href="#32" id="32">32</a>
<a href="#33" id="33">33</a>
<a href="#34" id="34">34</a>
<a href="#35" id="35">35</a>
<a href="#36" id="36">36</a>
<a href="#37" id="37">37</a>
<a href="#38" id="38">38</a>
<a href="#39" id="39">39</a>
<a href="#40" id="40">40</a>
<a href="#41" id="41">41</a>
<a href="#42" id="42">42</a>
<a href="#43" id="43">43</a>
<a href="#44" id="44">44</a>
<a href="#45" id="45">45</a>
<a href="#46" id="46">46</a>
<a href="#47" id="47">47</a>
<a href="#48" id="48">48</a>
<a href="#49" id="49">49</a>
<a href="#50" id="50">50</a>
<a href="#51" id="51">51</a>
<a href="#52" id="52">52</a>
<a href="#53" id="53">53</a>
<a href="#54" id="54">54</a>
<a href="#55" id="55">55</a>
<a href="#56" id="56">56</a>
<a href="#57" id="57">57</a>
<a href="#58" id="58">58</a>
<a href="#59" id="59">59</a>
<a href="#60" id="60">60</a>
<a href="#61" id="61">61</a>
<a href="#62" id="62">62</a>
<a href="#63" id="63">63</a>
<a href="#64" id="64">64</a>
<a href="#65" id="65">65</a>
<a href="#66" id="66">66</a>
<a href="#67" id="67">67</a>
<a href="#68" id="68">68</a>
<a href="#69" id="69">69</a>
<a href="#70" id="70">70</a>
<a href="#71" id="71">71</a>
<a href="#72" id="72">72</a>
<a href="#73" id="73">73</a>
<a href="#74" id="74">74</a>
<a href="#75" id="75">75</a>
<a href="#76" id="76">76</a>
<a href="#77" id="77">77</a>
<a href="#78" id="78">78</a>
<a href="#79" id="79">79</a>
<a href="#80" id="80">80</a>
<a href="#81" id="81">81</a>
<a href="#82" id="82">82</a>
<a href="#83" id="83">83</a>
<a href="#84" id="84">84</a>
<a href="#85" id="85">85</a>
<a href="#86" id="86">86</a>
<a href="#87" id="87">87</a>
<a href="#88" id="88">88</a>
<a href="#89" id="89">89</a>
<a href="#90" id="90">90</a>
<a href="#91" id="91">91</a>
<a href="#92" id="92">92</a>
<a href="#93" id="93">93</a>
<a href="#94" id="94">94</a>
<a href="#95" id="95">95</a>
<a href="#96" id="96">96</a>
<a href="#97" id="97">97</a>
<a href="#98" id="98">98</a>
<a href="#99" id="99">99</a>
<a href="#100" id="100">100</a>
<a href="#101" id="101">101</a>
<a href="#102" id="102">102</a>
<a href="#103" id="103">103</a>
<a href="#104" id="104">104</a>
<a href="#105" id="105">105</a>
<a href="#106" id="106">106</a>
<a href="#107" id="107">107</a>
<a href="#108" id="108">108</a>
<a href="#109" id="109">109</a>
<a href="#110" id="110">110</a>
<a href="#111" id="111">111</a>
<a href="#112" id="112">112</a>
<a href="#113" id="113">113</a>
<a href="#114" id="114">114</a>
<a href="#115" id="115">115</a>
<a href="#116" id="116">116</a>
<a href="#117" id="117">117</a>
<a href="#118" id="118">118</a>
<a href="#119" id="119">119</a>
<a href="#120" id="120">120</a>
<a href="#121" id="121">121</a>
<a href="#122" id="122">122</a>
<a href="#123" id="123">123</a>
<a href="#124" id="124">124</a>
<a href="#125" id="125">125</a>
<a href="#126" id="126">126</a>
<a href="#127" id="127">127</a>
<a href="#128" id="128">128</a>
<a href="#129" id="129">129</a>
<a href="#130" id="130">130</a>
<a href="#131" id="131">131</a>
<a href="#132" id="132">132</a>
<a href="#133" id="133">133</a>
<a href="#134" id="134">134</a>
<a href="#135" id="135">135</a>
<a href="#136" id="136">136</a>
<a href="#137" id="137">137</a>
<a href="#138" id="138">138</a>
<a href="#139" id="139">139</a>
<a href="#140" id="140">140</a>
<a href="#141" id="141">141</a>
<a href="#142" id="142">142</a>
<a href="#143" id="143">143</a>
<a href="#144" id="144">144</a>
<a href="#145" id="145">145</a>
<a href="#146" id="146">146</a>
<a href="#147" id="147">147</a>
<a href="#148" id="148">148</a>
<a href="#149" id="149">149</a>
<a href="#150" id="150">150</a>
<a href="#151" id="151">151</a>
<a href="#152" id="152">152</a>
<a href="#153" id="153">153</a>
<a href="#154" id="154">154</a>
<a href="#155" id="155">155</a>
<a href="#156" id="156">156</a>
<a href="#157" id="157">157</a>
<a href="#158" id="158">158</a>
<a href="#159" id="159">159</a>
<a href="#160" id="160">160</a>
<a href="#161" id="161">161</a>
<a href="#162" id="162">162</a>
<a href="#163" id="163">163</a>
<a href="#164" id="164">164</a>
<a href="#165" id="165">165</a>
<a href="#166" id="166">166</a>
<a href="#167" id="167">167</a>
<a href="#168" id="168">168</a>
<a href="#169" id="169">169</a>
<a href="#170" id="170">170</a>
<a href="#171" id="171">171</a>
<a href="#172" id="172">172</a>
<a href="#173" id="173">173</a>
<a href="#174" id="174">174</a>
<a href="#175" id="175">175</a>
<a href="#176" id="176">176</a>
<a href="#177" id="177">177</a>
<a href="#178" id="178">178</a>
<a href="#179" id="179">179</a>
<a href="#180" id="180">180</a>
<a href="#181" id="181">181</a>
<a href="#182" id="182">182</a>
<a href="#183" id="183">183</a>
<a href="#184" id="184">184</a>
<a href="#185" id="185">185</a>
<a href="#186" id="186">186</a>
<a href="#187" id="187">187</a>
<a href="#188" id="188">188</a>
<a href="#189" id="189">189</a>
<a href="#190" id="190">190</a>
<a href="#191" id="191">191</a>
<a href="#192" id="192">192</a>
<a href="#193" id="193">193</a>
<a href="#194" id="194">194</a>
<a href="#195" id="195">195</a>
<a href="#196" id="196">196</a>
<a href="#197" id="197">197</a>
<a href="#198" id="198">198</a>
<a href="#199" id="199">199</a>
<a href="#200" id="200">200</a>
<a href="#201" id="201">201</a>
<a href="#202" id="202">202</a>
<a href="#203" id="203">203</a>
<a href="#204" id="204">204</a>
<a href="#205" id="205">205</a>
<a href="#206" id="206">206</a>
<a href="#207" id="207">207</a>
<a href="#208" id="208">208</a>
<a href="#209" id="209">209</a>
<a href="#210" id="210">210</a>
<a href="#211" id="211">211</a>
<a href="#212" id="212">212</a>
<a href="#213" id="213">213</a>
<a href="#214" id="214">214</a>
<a href="#215" id="215">215</a>
<a href="#216" id="216">216</a>
<a href="#217" id="217">217</a>
<a href="#218" id="218">218</a>
<a href="#219" id="219">219</a>
<a href="#220" id="220">220</a>
<a href="#221" id="221">221</a>
<a href="#222" id="222">222</a>
<a href="#223" id="223">223</a>
<a href="#224" id="224">224</a>
<a href="#225" id="225">225</a>
<a href="#226" id="226">226</a>
<a href="#227" id="227">227</a>
<a href="#228" id="228">228</a>
<a href="#229" id="229">229</a>
<a href="#230" id="230">230</a>
<a href="#231" id="231">231</a>
<a href="#232" id="232">232</a>
<a href="#233" id="233">233</a>
<a href="#234" id="234">234</a>
<a href="#235" id="235">235</a>
<a href="#236" id="236">236</a>
<a href="#237" id="237">237</a>
<a href="#238" id="238">238</a>
<a href="#239" id="239">239</a>
<a href="#240" id="240">240</a>
<a href="#241" id="241">241</a>
<a href="#242" id="242">242</a>
<a href="#243" id="243">243</a>
<a href="#244" id="244">244</a>
<a href="#245" id="245">245</a>
<a href="#246" id="246">246</a>
<a href="#247" id="247">247</a>
<a href="#248" id="248">248</a>
<a href="#249" id="249">249</a>
<a href="#250" id="250">250</a>
<a href="#251" id="251">251</a>
<a href="#252" id="252">252</a>
<a href="#253" id="253">253</a>
<a href="#254" id="254">254</a>
<a href="#255" id="255">255</a>
<a href="#256" id="256">256</a>
<a href="#257" id="257">257</a>
<a href="#258" id="258">258</a>
<a href="#259" id="259">259</a>
<a href="#260" id="260">260</a>
<a href="#261" id="261">261</a>
<a href="#262" id="262">262</a>
<a href="#263" id="263">263</a>
<a href="#264" id="264">264</a>
<a href="#265" id="265">265</a>
<a href="#266" id="266">266</a>
<a href="#267" id="267">267</a>
<a href="#268" id="268">268</a>
<a href="#269" id="269">269</a>
<a href="#270" id="270">270</a>
<a href="#271" id="271">271</a>
<a href="#272" id="272">272</a>
<a href="#273" id="273">273</a>
<a href="#274" id="274">274</a>
<a href="#275" id="275">275</a>
<a href="#276" id="276">276</a>
<a href="#277" id="277">277</a>
<a href="#278" id="278">278</a>
<a href="#279" id="279">279</a>
<a href="#280" id="280">280</a>
<a href="#281" id="281">281</a>
<a href="#282" id="282">282</a>
<a href="#283" id="283">283</a>
<a href="#284" id="284">284</a>
<a href="#285" id="285">285</a>
<a href="#286" id="286">286</a>
<a href="#287" id="287">287</a>
<a href="#288" id="288">288</a>
<a href="#289" id="289">289</a>
<a href="#290" id="290">290</a>
<a href="#291" id="291">291</a>
<a href="#292" id="292">292</a>
<a href="#293" id="293">293</a>
<a href="#294" id="294">294</a>
<a href="#295" id="295">295</a>
<a href="#296" id="296">296</a>
<a href="#297" id="297">297</a>
<a href="#298" id="298">298</a>
<a href="#299" id="299">299</a>
<a href="#300" id="300">300</a>
<a href="#301" id="301">301</a>
<a href="#302" id="302">302</a>
<a href="#303" id="303">303</a>
<a href="#304" id="304">304</a>
<a href="#305" id="305">305</a>
<a href="#306" id="306">306</a>
<a href="#307" id="307">307</a>
<a href="#308" id="308">308</a>
<a href="#309" id="309">309</a>
<a href="#310" id="310">310</a>
<a href="#311" id="311">311</a>
<a href="#312" id="312">312</a>
<a href="#313" id="313">313</a>
<a href="#314" id="314">314</a>
<a href="#315" id="315">315</a>
<a href="#316" id="316">316</a>
<a href="#317" id="317">317</a>
<a href="#318" id="318">318</a>
<a href="#319" id="319">319</a>
<a href="#320" id="320">320</a>
<a href="#321" id="321">321</a>
<a href="#322" id="322">322</a>
<a href="#323" id="323">323</a>
<a href="#324" id="324">324</a>
<a href="#325" id="325">325</a>
<a href="#326" id="326">326</a>
<a href="#327" id="327">327</a>
<a href="#328" id="328">328</a>
<a href="#329" id="329">329</a>
<a href="#330" id="330">330</a>
<a href="#331" id="331">331</a>
<a href="#332" id="332">332</a>
<a href="#333" id="333">333</a>
<a href="#334" id="334">334</a>
<a href="#335" id="335">335</a>
<a href="#336" id="336">336</a>
<a href="#337" id="337">337</a>
<a href="#338" id="338">338</a>
<a href="#339" id="339">339</a>
<a href="#340" id="340">340</a>
<a href="#341" id="341">341</a>
<a href="#342" id="342">342</a>
<a href="#343" id="343">343</a>
<a href="#344" id="344">344</a>
<a href="#345" id="345">345</a>
<a href="#346" id="346">346</a>
<a href="#347" id="347">347</a>
<a href="#348" id="348">348</a>
<a href="#349" id="349">349</a>
<a href="#350" id="350">350</a>
<a href="#351" id="351">351</a>
<a href="#352" id="352">352</a>
<a href="#353" id="353">353</a>
<a href="#354" id="354">354</a>
<a href="#355" id="355">355</a>
<a href="#356" id="356">356</a>
<a href="#357" id="357">357</a>
<a href="#358" id="358">358</a>
<a href="#359" id="359">359</a>
<a href="#360" id="360">360</a>
<a href="#361" id="361">361</a>
<a href="#362" id="362">362</a>
<a href="#363" id="363">363</a>
<a href="#364" id="364">364</a>
<a href="#365" id="365">365</a>
<a href="#366" id="366">366</a>
<a href="#367" id="367">367</a>
<a href="#368" id="368">368</a>
<a href="#369" id="369">369</a>
<a href="#370" id="370">370</a>
<a href="#371" id="371">371</a>
<a href="#372" id="372">372</a>
<a href="#373" id="373">373</a>
<a href="#374" id="374">374</a>
<a href="#375" id="375">375</a>
<a href="#376" id="376">376</a>
<a href="#377" id="377">377</a>
<a href="#378" id="378">378</a>
<a href="#379" id="379">379</a>
<a href="#380" id="380">380</a>
<a href="#381" id="381">381</a>
<a href="#382" id="382">382</a>
<a href="#383" id="383">383</a>
<a href="#384" id="384">384</a>
<a href="#385" id="385">385</a>
<a href="#386" id="386">386</a>
<a href="#387" id="387">387</a>
<a href="#388" id="388">388</a>
<a href="#389" id="389">389</a>
<a href="#390" id="390">390</a>
<a href="#391" id="391">391</a>
<a href="#392" id="392">392</a>
<a href="#393" id="393">393</a>
<a href="#394" id="394">394</a>
<a href="#395" id="395">395</a>
<a href="#396" id="396">396</a>
<a href="#397" id="397">397</a>
<a href="#398" id="398">398</a>
<a href="#399" id="399">399</a>
<a href="#400" id="400">400</a>
<a href="#401" id="401">401</a>
<a href="#402" id="402">402</a>
<a href="#403" id="403">403</a>
<a href="#404" id="404">404</a>
<a href="#405" id="405">405</a>
<a href="#406" id="406">406</a>
<a href="#407" id="407">407</a>
<a href="#408" id="408">408</a>
<a href="#409" id="409">409</a>
<a href="#410" id="410">410</a>
<a href="#411" id="411">411</a>
<a href="#412" id="412">412</a>
<a href="#413" id="413">413</a>
<a href="#414" id="414">414</a>
<a href="#415" id="415">415</a>
<a href="#416" id="416">416</a>
<a href="#417" id="417">417</a>
<a href="#418" id="418">418</a>
<a href="#419" id="419">419</a>
<a href="#420" id="420">420</a>
<a href="#421" id="421">421</a>
<a href="#422" id="422">422</a>
<a href="#423" id="423">423</a>
<a href="#424" id="424">424</a>
<a href="#425" id="425">425</a>
<a href="#426" id="426">426</a>
<a href="#427" id="427">427</a>
<a href="#428" id="428">428</a>
<a href="#429" id="429">429</a>
<a href="#430" id="430">430</a>
<a href="#431" id="431">431</a>
<a href="#432" id="432">432</a>
<a href="#433" id="433">433</a>
<a href="#434" id="434">434</a>
<a href="#435" id="435">435</a>
<a href="#436" id="436">436</a>
<a href="#437" id="437">437</a>
<a href="#438" id="438">438</a>
<a href="#439" id="439">439</a>
<a href="#440" id="440">440</a>
<a href="#441" id="441">441</a>
<a href="#442" id="442">442</a>
<a href="#443" id="443">443</a>
<a href="#444" id="444">444</a>
<a href="#445" id="445">445</a>
<a href="#446" id="446">446</a>
<a href="#447" id="447">447</a>
<a href="#448" id="448">448</a>
<a href="#449" id="449">449</a>
<a href="#450" id="450">450</a>
<a href="#451" id="451">451</a>
<a href="#452" id="452">452</a>
<a href="#453" id="453">453</a>
<a href="#454" id="454">454</a>
<a href="#455" id="455">455</a>
<a href="#456" id="456">456</a>
<a href="#457" id="457">457</a>
<a href="#458" id="458">458</a>
<a href="#459" id="459">459</a>
<a href="#460" id="460">460</a>
<a href="#461" id="461">461</a>
<a href="#462" id="462">462</a>
<a href="#463" id="463">463</a>
<a href="#464" id="464">464</a>
<a href="#465" id="465">465</a>
<a href="#466" id="466">466</a>
<a href="#467" id="467">467</a>
<a href="#468" id="468">468</a>
<a href="#469" id="469">469</a>
<a href="#470" id="470">470</a>
<a href="#471" id="471">471</a>
<a href="#472" id="472">472</a>
<a href="#473" id="473">473</a>
<a href="#474" id="474">474</a>
<a href="#475" id="475">475</a>
<a href="#476" id="476">476</a>
<a href="#477" id="477">477</a>
<a href="#478" id="478">478</a>
<a href="#479" id="479">479</a>
<a href="#480" id="480">480</a>
<a href="#481" id="481">481</a>
<a href="#482" id="482">482</a>
<a href="#483" id="483">483</a>
<a href="#484" id="484">484</a>
<a href="#485" id="485">485</a>
<a href="#486" id="486">486</a>
<a href="#487" id="487">487</a>
<a href="#488" id="488">488</a>
<a href="#489" id="489">489</a>
<a href="#490" id="490">490</a>
<a href="#491" id="491">491</a>
<a href="#492" id="492">492</a>
<a href="#493" id="493">493</a>
<a href="#494" id="494">494</a>
<a href="#495" id="495">495</a>
<a href="#496" id="496">496</a>
<a href="#497" id="497">497</a>
<a href="#498" id="498">498</a>
<a href="#499" id="499">499</a>
<a href="#500" id="500">500</a>
<a href="#501" id="501">501</a>
<a href="#502" id="502">502</a>
<a href="#503" id="503">503</a>
<a href="#504" id="504">504</a>
<a href="#505" id="505">505</a>
<a href="#506" id="506">506</a>
<a href="#507" id="507">507</a>
<a href="#508" id="508">508</a>
<a href="#509" id="509">509</a>
<a href="#510" id="510">510</a>
<a href="#511" id="511">511</a>
<a href="#512" id="512">512</a>
<a href="#513" id="513">513</a>
<a href="#514" id="514">514</a>
</pre></div><pre class="rust"><code><span class="kw">use </span><span class="kw">crate</span>::num::arithmetic::traits::{
    ModMul, ModMulAssign, ModMulPrecomputed, ModMulPrecomputedAssign, Parity, PowerOf2,
    WrappingSubAssign,
};
<span class="kw">use </span><span class="kw">crate</span>::num::basic::integers::PrimitiveInt;
<span class="kw">use </span><span class="kw">crate</span>::num::basic::unsigneds::PrimitiveUnsigned;
<span class="kw">use </span><span class="kw">crate</span>::num::conversion::traits::{ExactFrom, HasHalf, JoinHalves, SplitInHalf, WrappingFrom};
<span class="kw">use </span><span class="kw">crate</span>::num::logic::traits::LeadingZeros;

<span class="macro">pub_test! </span>{naive_mod_mul&lt;T: PrimitiveUnsigned&gt;(x: T, y: T, m: T) -&gt; T {
    <span class="macro">assert!</span>(x &lt; m, <span class="string">"x must be reduced mod m, but {x} &gt;= {m}"</span>);
    <span class="macro">assert!</span>(y &lt; m, <span class="string">"y must be reduced mod m, but {y} &gt;= {m}"</span>);
    <span class="kw">let </span>(product_1, product_0) = T::x_mul_y_to_zz(x, y);
    T::xx_div_mod_y_to_qr(product_1, product_0, m).<span class="number">1
</span>}}

<span class="kw">const </span>INVERT_U32_TABLE_LOG_SIZE: u64 = <span class="number">9</span>;

<span class="kw">const </span>INVERT_U32_TABLE_SIZE: usize = <span class="number">1 </span>&lt;&lt; INVERT_U32_TABLE_LOG_SIZE;

<span class="comment">// INVERT_U32_TABLE[i] = floor((2^24 - 2^14 + 2^9) / (2^9 + i))
</span><span class="kw">const </span>INVERT_U32_TABLE: [u32; INVERT_U32_TABLE_SIZE] = [
    <span class="number">32737</span>, <span class="number">32673</span>, <span class="number">32609</span>, <span class="number">32546</span>, <span class="number">32483</span>, <span class="number">32420</span>, <span class="number">32357</span>, <span class="number">32295</span>, <span class="number">32233</span>, <span class="number">32171</span>, <span class="number">32109</span>, <span class="number">32048</span>, <span class="number">31987</span>,
    <span class="number">31926</span>, <span class="number">31865</span>, <span class="number">31805</span>, <span class="number">31744</span>, <span class="number">31684</span>, <span class="number">31625</span>, <span class="number">31565</span>, <span class="number">31506</span>, <span class="number">31447</span>, <span class="number">31388</span>, <span class="number">31329</span>, <span class="number">31271</span>, <span class="number">31212</span>,
    <span class="number">31154</span>, <span class="number">31097</span>, <span class="number">31039</span>, <span class="number">30982</span>, <span class="number">30924</span>, <span class="number">30868</span>, <span class="number">30811</span>, <span class="number">30754</span>, <span class="number">30698</span>, <span class="number">30642</span>, <span class="number">30586</span>, <span class="number">30530</span>, <span class="number">30475</span>,
    <span class="number">30419</span>, <span class="number">30364</span>, <span class="number">30309</span>, <span class="number">30255</span>, <span class="number">30200</span>, <span class="number">30146</span>, <span class="number">30092</span>, <span class="number">30038</span>, <span class="number">29984</span>, <span class="number">29930</span>, <span class="number">29877</span>, <span class="number">29824</span>, <span class="number">29771</span>,
    <span class="number">29718</span>, <span class="number">29666</span>, <span class="number">29613</span>, <span class="number">29561</span>, <span class="number">29509</span>, <span class="number">29457</span>, <span class="number">29405</span>, <span class="number">29354</span>, <span class="number">29303</span>, <span class="number">29251</span>, <span class="number">29200</span>, <span class="number">29150</span>, <span class="number">29099</span>,
    <span class="number">29049</span>, <span class="number">28998</span>, <span class="number">28948</span>, <span class="number">28898</span>, <span class="number">28849</span>, <span class="number">28799</span>, <span class="number">28750</span>, <span class="number">28700</span>, <span class="number">28651</span>, <span class="number">28602</span>, <span class="number">28554</span>, <span class="number">28505</span>, <span class="number">28457</span>,
    <span class="number">28409</span>, <span class="number">28360</span>, <span class="number">28313</span>, <span class="number">28265</span>, <span class="number">28217</span>, <span class="number">28170</span>, <span class="number">28123</span>, <span class="number">28075</span>, <span class="number">28029</span>, <span class="number">27982</span>, <span class="number">27935</span>, <span class="number">27889</span>, <span class="number">27842</span>,
    <span class="number">27796</span>, <span class="number">27750</span>, <span class="number">27704</span>, <span class="number">27658</span>, <span class="number">27613</span>, <span class="number">27568</span>, <span class="number">27522</span>, <span class="number">27477</span>, <span class="number">27432</span>, <span class="number">27387</span>, <span class="number">27343</span>, <span class="number">27298</span>, <span class="number">27254</span>,
    <span class="number">27209</span>, <span class="number">27165</span>, <span class="number">27121</span>, <span class="number">27078</span>, <span class="number">27034</span>, <span class="number">26990</span>, <span class="number">26947</span>, <span class="number">26904</span>, <span class="number">26861</span>, <span class="number">26818</span>, <span class="number">26775</span>, <span class="number">26732</span>, <span class="number">26690</span>,
    <span class="number">26647</span>, <span class="number">26605</span>, <span class="number">26563</span>, <span class="number">26521</span>, <span class="number">26479</span>, <span class="number">26437</span>, <span class="number">26395</span>, <span class="number">26354</span>, <span class="number">26312</span>, <span class="number">26271</span>, <span class="number">26230</span>, <span class="number">26189</span>, <span class="number">26148</span>,
    <span class="number">26108</span>, <span class="number">26067</span>, <span class="number">26026</span>, <span class="number">25986</span>, <span class="number">25946</span>, <span class="number">25906</span>, <span class="number">25866</span>, <span class="number">25826</span>, <span class="number">25786</span>, <span class="number">25747</span>, <span class="number">25707</span>, <span class="number">25668</span>, <span class="number">25628</span>,
    <span class="number">25589</span>, <span class="number">25550</span>, <span class="number">25511</span>, <span class="number">25473</span>, <span class="number">25434</span>, <span class="number">25395</span>, <span class="number">25357</span>, <span class="number">25319</span>, <span class="number">25281</span>, <span class="number">25242</span>, <span class="number">25205</span>, <span class="number">25167</span>, <span class="number">25129</span>,
    <span class="number">25091</span>, <span class="number">25054</span>, <span class="number">25016</span>, <span class="number">24979</span>, <span class="number">24942</span>, <span class="number">24905</span>, <span class="number">24868</span>, <span class="number">24831</span>, <span class="number">24794</span>, <span class="number">24758</span>, <span class="number">24721</span>, <span class="number">24685</span>, <span class="number">24649</span>,
    <span class="number">24612</span>, <span class="number">24576</span>, <span class="number">24540</span>, <span class="number">24504</span>, <span class="number">24469</span>, <span class="number">24433</span>, <span class="number">24397</span>, <span class="number">24362</span>, <span class="number">24327</span>, <span class="number">24291</span>, <span class="number">24256</span>, <span class="number">24221</span>, <span class="number">24186</span>,
    <span class="number">24151</span>, <span class="number">24117</span>, <span class="number">24082</span>, <span class="number">24047</span>, <span class="number">24013</span>, <span class="number">23979</span>, <span class="number">23944</span>, <span class="number">23910</span>, <span class="number">23876</span>, <span class="number">23842</span>, <span class="number">23808</span>, <span class="number">23774</span>, <span class="number">23741</span>,
    <span class="number">23707</span>, <span class="number">23674</span>, <span class="number">23640</span>, <span class="number">23607</span>, <span class="number">23574</span>, <span class="number">23541</span>, <span class="number">23508</span>, <span class="number">23475</span>, <span class="number">23442</span>, <span class="number">23409</span>, <span class="number">23377</span>, <span class="number">23344</span>, <span class="number">23312</span>,
    <span class="number">23279</span>, <span class="number">23247</span>, <span class="number">23215</span>, <span class="number">23183</span>, <span class="number">23151</span>, <span class="number">23119</span>, <span class="number">23087</span>, <span class="number">23055</span>, <span class="number">23023</span>, <span class="number">22992</span>, <span class="number">22960</span>, <span class="number">22929</span>, <span class="number">22898</span>,
    <span class="number">22866</span>, <span class="number">22835</span>, <span class="number">22804</span>, <span class="number">22773</span>, <span class="number">22742</span>, <span class="number">22711</span>, <span class="number">22681</span>, <span class="number">22650</span>, <span class="number">22619</span>, <span class="number">22589</span>, <span class="number">22559</span>, <span class="number">22528</span>, <span class="number">22498</span>,
    <span class="number">22468</span>, <span class="number">22438</span>, <span class="number">22408</span>, <span class="number">22378</span>, <span class="number">22348</span>, <span class="number">22318</span>, <span class="number">22289</span>, <span class="number">22259</span>, <span class="number">22229</span>, <span class="number">22200</span>, <span class="number">22171</span>, <span class="number">22141</span>, <span class="number">22112</span>,
    <span class="number">22083</span>, <span class="number">22054</span>, <span class="number">22025</span>, <span class="number">21996</span>, <span class="number">21967</span>, <span class="number">21938</span>, <span class="number">21910</span>, <span class="number">21881</span>, <span class="number">21853</span>, <span class="number">21824</span>, <span class="number">21796</span>, <span class="number">21767</span>, <span class="number">21739</span>,
    <span class="number">21711</span>, <span class="number">21683</span>, <span class="number">21655</span>, <span class="number">21627</span>, <span class="number">21599</span>, <span class="number">21571</span>, <span class="number">21544</span>, <span class="number">21516</span>, <span class="number">21488</span>, <span class="number">21461</span>, <span class="number">21433</span>, <span class="number">21406</span>, <span class="number">21379</span>,
    <span class="number">21352</span>, <span class="number">21324</span>, <span class="number">21297</span>, <span class="number">21270</span>, <span class="number">21243</span>, <span class="number">21216</span>, <span class="number">21190</span>, <span class="number">21163</span>, <span class="number">21136</span>, <span class="number">21110</span>, <span class="number">21083</span>, <span class="number">21056</span>, <span class="number">21030</span>,
    <span class="number">21004</span>, <span class="number">20977</span>, <span class="number">20951</span>, <span class="number">20925</span>, <span class="number">20899</span>, <span class="number">20873</span>, <span class="number">20847</span>, <span class="number">20821</span>, <span class="number">20795</span>, <span class="number">20769</span>, <span class="number">20744</span>, <span class="number">20718</span>, <span class="number">20693</span>,
    <span class="number">20667</span>, <span class="number">20642</span>, <span class="number">20616</span>, <span class="number">20591</span>, <span class="number">20566</span>, <span class="number">20540</span>, <span class="number">20515</span>, <span class="number">20490</span>, <span class="number">20465</span>, <span class="number">20440</span>, <span class="number">20415</span>, <span class="number">20390</span>, <span class="number">20366</span>,
    <span class="number">20341</span>, <span class="number">20316</span>, <span class="number">20292</span>, <span class="number">20267</span>, <span class="number">20243</span>, <span class="number">20218</span>, <span class="number">20194</span>, <span class="number">20170</span>, <span class="number">20145</span>, <span class="number">20121</span>, <span class="number">20097</span>, <span class="number">20073</span>, <span class="number">20049</span>,
    <span class="number">20025</span>, <span class="number">20001</span>, <span class="number">19977</span>, <span class="number">19953</span>, <span class="number">19930</span>, <span class="number">19906</span>, <span class="number">19882</span>, <span class="number">19859</span>, <span class="number">19835</span>, <span class="number">19812</span>, <span class="number">19789</span>, <span class="number">19765</span>, <span class="number">19742</span>,
    <span class="number">19719</span>, <span class="number">19696</span>, <span class="number">19672</span>, <span class="number">19649</span>, <span class="number">19626</span>, <span class="number">19603</span>, <span class="number">19581</span>, <span class="number">19558</span>, <span class="number">19535</span>, <span class="number">19512</span>, <span class="number">19489</span>, <span class="number">19467</span>, <span class="number">19444</span>,
    <span class="number">19422</span>, <span class="number">19399</span>, <span class="number">19377</span>, <span class="number">19354</span>, <span class="number">19332</span>, <span class="number">19310</span>, <span class="number">19288</span>, <span class="number">19265</span>, <span class="number">19243</span>, <span class="number">19221</span>, <span class="number">19199</span>, <span class="number">19177</span>, <span class="number">19155</span>,
    <span class="number">19133</span>, <span class="number">19112</span>, <span class="number">19090</span>, <span class="number">19068</span>, <span class="number">19046</span>, <span class="number">19025</span>, <span class="number">19003</span>, <span class="number">18982</span>, <span class="number">18960</span>, <span class="number">18939</span>, <span class="number">18917</span>, <span class="number">18896</span>, <span class="number">18875</span>,
    <span class="number">18854</span>, <span class="number">18832</span>, <span class="number">18811</span>, <span class="number">18790</span>, <span class="number">18769</span>, <span class="number">18748</span>, <span class="number">18727</span>, <span class="number">18706</span>, <span class="number">18686</span>, <span class="number">18665</span>, <span class="number">18644</span>, <span class="number">18623</span>, <span class="number">18603</span>,
    <span class="number">18582</span>, <span class="number">18561</span>, <span class="number">18541</span>, <span class="number">18520</span>, <span class="number">18500</span>, <span class="number">18479</span>, <span class="number">18459</span>, <span class="number">18439</span>, <span class="number">18419</span>, <span class="number">18398</span>, <span class="number">18378</span>, <span class="number">18358</span>, <span class="number">18338</span>,
    <span class="number">18318</span>, <span class="number">18298</span>, <span class="number">18278</span>, <span class="number">18258</span>, <span class="number">18238</span>, <span class="number">18218</span>, <span class="number">18199</span>, <span class="number">18179</span>, <span class="number">18159</span>, <span class="number">18139</span>, <span class="number">18120</span>, <span class="number">18100</span>, <span class="number">18081</span>,
    <span class="number">18061</span>, <span class="number">18042</span>, <span class="number">18022</span>, <span class="number">18003</span>, <span class="number">17984</span>, <span class="number">17964</span>, <span class="number">17945</span>, <span class="number">17926</span>, <span class="number">17907</span>, <span class="number">17888</span>, <span class="number">17869</span>, <span class="number">17850</span>, <span class="number">17831</span>,
    <span class="number">17812</span>, <span class="number">17793</span>, <span class="number">17774</span>, <span class="number">17755</span>, <span class="number">17736</span>, <span class="number">17718</span>, <span class="number">17699</span>, <span class="number">17680</span>, <span class="number">17662</span>, <span class="number">17643</span>, <span class="number">17624</span>, <span class="number">17606</span>, <span class="number">17587</span>,
    <span class="number">17569</span>, <span class="number">17551</span>, <span class="number">17532</span>, <span class="number">17514</span>, <span class="number">17496</span>, <span class="number">17477</span>, <span class="number">17459</span>, <span class="number">17441</span>, <span class="number">17423</span>, <span class="number">17405</span>, <span class="number">17387</span>, <span class="number">17369</span>, <span class="number">17351</span>,
    <span class="number">17333</span>, <span class="number">17315</span>, <span class="number">17297</span>, <span class="number">17279</span>, <span class="number">17261</span>, <span class="number">17244</span>, <span class="number">17226</span>, <span class="number">17208</span>, <span class="number">17191</span>, <span class="number">17173</span>, <span class="number">17155</span>, <span class="number">17138</span>, <span class="number">17120</span>,
    <span class="number">17103</span>, <span class="number">17085</span>, <span class="number">17068</span>, <span class="number">17051</span>, <span class="number">17033</span>, <span class="number">17016</span>, <span class="number">16999</span>, <span class="number">16982</span>, <span class="number">16964</span>, <span class="number">16947</span>, <span class="number">16930</span>, <span class="number">16913</span>, <span class="number">16896</span>,
    <span class="number">16879</span>, <span class="number">16862</span>, <span class="number">16845</span>, <span class="number">16828</span>, <span class="number">16811</span>, <span class="number">16794</span>, <span class="number">16778</span>, <span class="number">16761</span>, <span class="number">16744</span>, <span class="number">16727</span>, <span class="number">16711</span>, <span class="number">16694</span>, <span class="number">16677</span>,
    <span class="number">16661</span>, <span class="number">16644</span>, <span class="number">16628</span>, <span class="number">16611</span>, <span class="number">16595</span>, <span class="number">16578</span>, <span class="number">16562</span>, <span class="number">16546</span>, <span class="number">16529</span>, <span class="number">16513</span>, <span class="number">16497</span>, <span class="number">16481</span>, <span class="number">16464</span>,
    <span class="number">16448</span>, <span class="number">16432</span>, <span class="number">16416</span>, <span class="number">16400</span>, <span class="number">16384</span>,
];

<span class="attr">#[cfg(feature = <span class="string">"test_build"</span>)]
</span><span class="kw">pub fn </span>test_invert_u32_table() {
    <span class="kw">for </span>(i, <span class="kw-2">&amp;</span>x) <span class="kw">in </span>INVERT_U32_TABLE.iter().enumerate() {
        <span class="kw">let </span>value = (u32::power_of_2(<span class="number">24</span>) - u32::power_of_2(<span class="number">14</span>) + u32::power_of_2(<span class="number">9</span>))
            / (u32::power_of_2(<span class="number">9</span>) + u32::exact_from(i));
        <span class="macro">assert_eq!</span>(
            x, value,
            <span class="string">"INVERT_U32_TABLE gives incorrect value, {x}, for index {i}"
        </span>);
    }
}

<span class="comment">// Computes
// $$
// f(x) = \left \lfloor \frac{2^{64} - 2^{32}x - 1}{x} \right \rfloor =
//     \left \lfloor \frac{2^{64}-1}{x}-2^{32} \right \rfloor.
// $$
//
// The highest bit of `x` must be set.
//
// # Worst-case complexity
// Constant time and additional memory.
//
// This is equivalent to `invert_limb` from `longlong.h`, FLINT 2.7.1, when `GMP_LIMB_BITS == 32`.
</span><span class="macro">pub_crate_test! </span>{limbs_invert_limb_u32(x: u32) -&gt; u32 {
    <span class="macro">assert!</span>(x.get_highest_bit());
    <span class="kw">let </span>a = INVERT_U32_TABLE[usize::exact_from(x &lt;&lt; <span class="number">1 </span>&gt;&gt; <span class="number">23</span>)];
    <span class="kw">let </span>b = (a &lt;&lt; <span class="number">4</span>)
        .wrapping_sub((u64::from(a * a) * u64::from((x &gt;&gt; <span class="number">11</span>) + <span class="number">1</span>)).upper_half())
        .wrapping_sub(<span class="number">1</span>);
    <span class="kw">let </span><span class="kw-2">mut </span>c = b.wrapping_mul(x &gt;&gt; <span class="number">1</span>).wrapping_neg();
    <span class="kw">if </span>x.odd() {
        c.wrapping_sub_assign(b.wrapping_sub(b &gt;&gt; <span class="number">1</span>));
    }
    <span class="kw">let </span>d = (b &lt;&lt; <span class="number">15</span>).wrapping_add((u64::from(b) * u64::from(c)).upper_half() &gt;&gt; <span class="number">1</span>);
    d.wrapping_sub(
        (u64::from(d) * u64::from(x))
            .wrapping_add(u64::from(x))
            .upper_half()
            .wrapping_add(x),
    )
}}

<span class="kw">const </span>INVERT_U64_TABLE_LOG_SIZE: u64 = <span class="number">8</span>;

<span class="kw">const </span>INVERT_U64_TABLE_SIZE: usize = <span class="number">1 </span>&lt;&lt; INVERT_U64_TABLE_LOG_SIZE;

<span class="comment">// INVERT_U32_TABLE[i] = floor((2^19 - 3*2^8) / (2^8 + i))
</span><span class="kw">const </span>INVERT_U64_TABLE: [u64; INVERT_U64_TABLE_SIZE] = [
    <span class="number">2045</span>, <span class="number">2037</span>, <span class="number">2029</span>, <span class="number">2021</span>, <span class="number">2013</span>, <span class="number">2005</span>, <span class="number">1998</span>, <span class="number">1990</span>, <span class="number">1983</span>, <span class="number">1975</span>, <span class="number">1968</span>, <span class="number">1960</span>, <span class="number">1953</span>, <span class="number">1946</span>, <span class="number">1938</span>, <span class="number">1931</span>,
    <span class="number">1924</span>, <span class="number">1917</span>, <span class="number">1910</span>, <span class="number">1903</span>, <span class="number">1896</span>, <span class="number">1889</span>, <span class="number">1883</span>, <span class="number">1876</span>, <span class="number">1869</span>, <span class="number">1863</span>, <span class="number">1856</span>, <span class="number">1849</span>, <span class="number">1843</span>, <span class="number">1836</span>, <span class="number">1830</span>, <span class="number">1824</span>,
    <span class="number">1817</span>, <span class="number">1811</span>, <span class="number">1805</span>, <span class="number">1799</span>, <span class="number">1792</span>, <span class="number">1786</span>, <span class="number">1780</span>, <span class="number">1774</span>, <span class="number">1768</span>, <span class="number">1762</span>, <span class="number">1756</span>, <span class="number">1750</span>, <span class="number">1745</span>, <span class="number">1739</span>, <span class="number">1733</span>, <span class="number">1727</span>,
    <span class="number">1722</span>, <span class="number">1716</span>, <span class="number">1710</span>, <span class="number">1705</span>, <span class="number">1699</span>, <span class="number">1694</span>, <span class="number">1688</span>, <span class="number">1683</span>, <span class="number">1677</span>, <span class="number">1672</span>, <span class="number">1667</span>, <span class="number">1661</span>, <span class="number">1656</span>, <span class="number">1651</span>, <span class="number">1646</span>, <span class="number">1641</span>,
    <span class="number">1636</span>, <span class="number">1630</span>, <span class="number">1625</span>, <span class="number">1620</span>, <span class="number">1615</span>, <span class="number">1610</span>, <span class="number">1605</span>, <span class="number">1600</span>, <span class="number">1596</span>, <span class="number">1591</span>, <span class="number">1586</span>, <span class="number">1581</span>, <span class="number">1576</span>, <span class="number">1572</span>, <span class="number">1567</span>, <span class="number">1562</span>,
    <span class="number">1558</span>, <span class="number">1553</span>, <span class="number">1548</span>, <span class="number">1544</span>, <span class="number">1539</span>, <span class="number">1535</span>, <span class="number">1530</span>, <span class="number">1526</span>, <span class="number">1521</span>, <span class="number">1517</span>, <span class="number">1513</span>, <span class="number">1508</span>, <span class="number">1504</span>, <span class="number">1500</span>, <span class="number">1495</span>, <span class="number">1491</span>,
    <span class="number">1487</span>, <span class="number">1483</span>, <span class="number">1478</span>, <span class="number">1474</span>, <span class="number">1470</span>, <span class="number">1466</span>, <span class="number">1462</span>, <span class="number">1458</span>, <span class="number">1454</span>, <span class="number">1450</span>, <span class="number">1446</span>, <span class="number">1442</span>, <span class="number">1438</span>, <span class="number">1434</span>, <span class="number">1430</span>, <span class="number">1426</span>,
    <span class="number">1422</span>, <span class="number">1418</span>, <span class="number">1414</span>, <span class="number">1411</span>, <span class="number">1407</span>, <span class="number">1403</span>, <span class="number">1399</span>, <span class="number">1396</span>, <span class="number">1392</span>, <span class="number">1388</span>, <span class="number">1384</span>, <span class="number">1381</span>, <span class="number">1377</span>, <span class="number">1374</span>, <span class="number">1370</span>, <span class="number">1366</span>,
    <span class="number">1363</span>, <span class="number">1359</span>, <span class="number">1356</span>, <span class="number">1352</span>, <span class="number">1349</span>, <span class="number">1345</span>, <span class="number">1342</span>, <span class="number">1338</span>, <span class="number">1335</span>, <span class="number">1332</span>, <span class="number">1328</span>, <span class="number">1325</span>, <span class="number">1322</span>, <span class="number">1318</span>, <span class="number">1315</span>, <span class="number">1312</span>,
    <span class="number">1308</span>, <span class="number">1305</span>, <span class="number">1302</span>, <span class="number">1299</span>, <span class="number">1295</span>, <span class="number">1292</span>, <span class="number">1289</span>, <span class="number">1286</span>, <span class="number">1283</span>, <span class="number">1280</span>, <span class="number">1276</span>, <span class="number">1273</span>, <span class="number">1270</span>, <span class="number">1267</span>, <span class="number">1264</span>, <span class="number">1261</span>,
    <span class="number">1258</span>, <span class="number">1255</span>, <span class="number">1252</span>, <span class="number">1249</span>, <span class="number">1246</span>, <span class="number">1243</span>, <span class="number">1240</span>, <span class="number">1237</span>, <span class="number">1234</span>, <span class="number">1231</span>, <span class="number">1228</span>, <span class="number">1226</span>, <span class="number">1223</span>, <span class="number">1220</span>, <span class="number">1217</span>, <span class="number">1214</span>,
    <span class="number">1211</span>, <span class="number">1209</span>, <span class="number">1206</span>, <span class="number">1203</span>, <span class="number">1200</span>, <span class="number">1197</span>, <span class="number">1195</span>, <span class="number">1192</span>, <span class="number">1189</span>, <span class="number">1187</span>, <span class="number">1184</span>, <span class="number">1181</span>, <span class="number">1179</span>, <span class="number">1176</span>, <span class="number">1173</span>, <span class="number">1171</span>,
    <span class="number">1168</span>, <span class="number">1165</span>, <span class="number">1163</span>, <span class="number">1160</span>, <span class="number">1158</span>, <span class="number">1155</span>, <span class="number">1153</span>, <span class="number">1150</span>, <span class="number">1148</span>, <span class="number">1145</span>, <span class="number">1143</span>, <span class="number">1140</span>, <span class="number">1138</span>, <span class="number">1135</span>, <span class="number">1133</span>, <span class="number">1130</span>,
    <span class="number">1128</span>, <span class="number">1125</span>, <span class="number">1123</span>, <span class="number">1121</span>, <span class="number">1118</span>, <span class="number">1116</span>, <span class="number">1113</span>, <span class="number">1111</span>, <span class="number">1109</span>, <span class="number">1106</span>, <span class="number">1104</span>, <span class="number">1102</span>, <span class="number">1099</span>, <span class="number">1097</span>, <span class="number">1095</span>, <span class="number">1092</span>,
    <span class="number">1090</span>, <span class="number">1088</span>, <span class="number">1086</span>, <span class="number">1083</span>, <span class="number">1081</span>, <span class="number">1079</span>, <span class="number">1077</span>, <span class="number">1074</span>, <span class="number">1072</span>, <span class="number">1070</span>, <span class="number">1068</span>, <span class="number">1066</span>, <span class="number">1064</span>, <span class="number">1061</span>, <span class="number">1059</span>, <span class="number">1057</span>,
    <span class="number">1055</span>, <span class="number">1053</span>, <span class="number">1051</span>, <span class="number">1049</span>, <span class="number">1047</span>, <span class="number">1044</span>, <span class="number">1042</span>, <span class="number">1040</span>, <span class="number">1038</span>, <span class="number">1036</span>, <span class="number">1034</span>, <span class="number">1032</span>, <span class="number">1030</span>, <span class="number">1028</span>, <span class="number">1026</span>, <span class="number">1024</span>,
];

<span class="doccomment">/// Tests that `INVERT_U64_TABLE` is correct.
</span><span class="attr">#[cfg(feature = <span class="string">"test_build"</span>)]
</span><span class="kw">pub fn </span>test_invert_u64_table() {
    <span class="kw">for </span>(i, <span class="kw-2">&amp;</span>x) <span class="kw">in </span>INVERT_U64_TABLE.iter().enumerate() {
        <span class="kw">let </span>value = (u64::power_of_2(<span class="number">19</span>) - <span class="number">3 </span>* u64::power_of_2(<span class="number">8</span>))
            / (u64::power_of_2(<span class="number">8</span>) + u64::exact_from(i));
        <span class="macro">assert_eq!</span>(
            x, value,
            <span class="string">"INVERT_U64_TABLE gives incorrect value, {x}, for index {i}"
        </span>);
    }
}

<span class="comment">// Computes
// $$
// f(x) = \left \lfloor \frac{2^{128} - 2^{64}x - 1}{x} \right \rfloor =
//     \left \lfloor \frac{2^{128}-1}{x}-2^{64} \right \rfloor.
// $$
//
// The highest bit of `x` must be set.
//
// # Worst-case complexity
// Constant time and additional memory.
//
// This is equivalent to `invert_limb` from `longlong.h`, FLINT 2.7.1, when `GMP_LIMB_BITS == 64`.
</span><span class="macro">pub_crate_test! </span>{limbs_invert_limb_u64(x: u64) -&gt; u64 {
    <span class="macro">assert!</span>(x.get_highest_bit());
    <span class="kw">let </span>a = (x &gt;&gt; <span class="number">24</span>) + <span class="number">1</span>;
    <span class="kw">let </span>b = INVERT_U64_TABLE[usize::exact_from(x &lt;&lt; <span class="number">1 </span>&gt;&gt; <span class="number">56</span>)];
    <span class="kw">let </span>c = (b &lt;&lt; <span class="number">11</span>).wrapping_sub(((b * b).wrapping_mul(a) &gt;&gt; <span class="number">40</span>) + <span class="number">1</span>);
    <span class="kw">let </span>d = (c.wrapping_mul(u64::power_of_2(<span class="number">60</span>).wrapping_sub(c.wrapping_mul(a))) &gt;&gt; <span class="number">47</span>)
        .wrapping_add(c &lt;&lt; <span class="number">13</span>);
    <span class="kw">let </span><span class="kw-2">mut </span>e = d.wrapping_mul(x &gt;&gt; <span class="number">1</span>).wrapping_neg();
    <span class="kw">if </span>x.odd() {
        e.wrapping_sub_assign(d.wrapping_sub(d &gt;&gt; <span class="number">1</span>));
    }
    <span class="kw">let </span>f = (d &lt;&lt; <span class="number">31</span>).wrapping_add((u128::from(d) * u128::from(e)).upper_half() &gt;&gt; <span class="number">1</span>);
    f.wrapping_sub(
        (u128::from(f) * u128::from(x))
            .wrapping_add(u128::from(x))
            .upper_half()
            .wrapping_add(x),
    )
}}

<span class="comment">// This is equivalent to `n_ll_mod_preinv` from `ulong_extras/ll_mod_preinv.c`, FLINT 2.7.1.
</span><span class="macro">pub_test! </span>{limbs_mod_preinverted&lt;
    T: PrimitiveUnsigned,
    DT: From&lt;T&gt; + HasHalf&lt;Half = T&gt; + JoinHalves + PrimitiveUnsigned + SplitInHalf,
&gt;(
    <span class="kw-2">mut </span>x_1: T,
    x_0: T,
    d: T,
    d_inv: T,
) -&gt; T {
    <span class="macro">assert_ne!</span>(d, T::ZERO);
    <span class="kw">let </span>d_inv = DT::from(d_inv);
    <span class="kw">let </span>shift = LeadingZeros::leading_zeros(d);
    <span class="kw">if </span>shift == <span class="number">0 </span>{
        <span class="kw">if </span>x_1 &gt;= d {
            x_1 -= d;
        }
        <span class="kw">let </span>(q_1, q_0) = (d_inv * DT::from(x_1))
            .wrapping_add(DT::join_halves(x_1, x_0))
            .split_in_half();
        <span class="kw">let </span><span class="kw-2">mut </span>r = x_0.wrapping_sub(q_1.wrapping_add(T::ONE).wrapping_mul(d));
        <span class="kw">if </span>r &gt; q_0 {
            r.wrapping_add_assign(d);
        }
        <span class="kw">if </span>r &lt; d {
            r
        } <span class="kw">else </span>{
            r - d
        }
    } <span class="kw">else </span>{
        <span class="kw">let </span><span class="kw-2">mut </span>d = d;
        <span class="kw">if </span>x_1 &gt;= d {
            <span class="kw">let </span>y_1 = x_1 &gt;&gt; (T::WIDTH - shift);
            <span class="kw">let </span>y_0 = x_1 &lt;&lt; shift;
            d &lt;&lt;= shift;
            <span class="kw">let </span>(q1, q0) = (d_inv * DT::from(y_1))
                .wrapping_add(DT::join_halves(y_1, y_0))
                .split_in_half();
            x_1 = y_0.wrapping_sub(q1.wrapping_add(T::ONE).wrapping_mul(d));
            <span class="kw">if </span>x_1 &gt; q0 {
                x_1.wrapping_add_assign(d);
            }
            <span class="kw">if </span>x_1 &gt;= d {
                x_1 -= d;
            }
        } <span class="kw">else </span>{
            d &lt;&lt;= shift;
            x_1 &lt;&lt;= shift;
        }
        <span class="kw">let </span>y_1 = x_1.wrapping_add(x_0 &gt;&gt; (T::WIDTH - shift));
        <span class="kw">let </span>y_0 = x_0 &lt;&lt; shift;
        <span class="kw">let </span>(q_1, q_0) = (d_inv * DT::from(y_1))
            .wrapping_add(DT::join_halves(y_1, y_0))
            .split_in_half();
        <span class="kw">let </span><span class="kw-2">mut </span>r = y_0.wrapping_sub(q_1.wrapping_add(T::ONE).wrapping_mul(d));
        <span class="kw">if </span>r &gt; q_0 {
            r.wrapping_add_assign(d);
        }
        <span class="kw">if </span>r &lt; d {
            r &gt;&gt; shift
        } <span class="kw">else </span>{
            (r - d) &gt;&gt; shift
        }
    }
}}

<span class="comment">// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1.
</span><span class="macro">pub_test! </span>{fast_mod_mul&lt;
    T: PrimitiveUnsigned,
    DT: From&lt;T&gt; + HasHalf&lt;Half = T&gt; + JoinHalves + PrimitiveUnsigned + SplitInHalf,
&gt;(
    x: T,
    y: T,
    m: T,
    inv: T,
) -&gt; T {
    <span class="macro">assert!</span>(x &lt; m, <span class="string">"x must be reduced mod m, but {x} &gt;= {m}"</span>);
    <span class="macro">assert!</span>(y &lt; m, <span class="string">"y must be reduced mod m, but {y} &gt;= {m}"</span>);
    <span class="kw">let </span>(product_1, product_0) = (DT::from(x) * DT::from(y)).split_in_half();
    limbs_mod_preinverted::&lt;T, DT&gt;(product_1, product_0, m, inv)
}}

<span class="macro">macro_rules! </span>impl_mod_mul_precomputed_fast {
    (<span class="macro-nonterminal">$t</span>:ident, <span class="macro-nonterminal">$dt</span>:ident, <span class="macro-nonterminal">$invert_limb</span>:ident) =&gt; {
        <span class="kw">impl </span>ModMulPrecomputed&lt;<span class="macro-nonterminal">$t</span>, <span class="macro-nonterminal">$t</span>&gt; <span class="kw">for </span><span class="macro-nonterminal">$t </span>{
            <span class="kw">type </span>Output = <span class="macro-nonterminal">$t</span>;
            <span class="kw">type </span>Data = <span class="macro-nonterminal">$t</span>;

            <span class="doccomment">/// Precomputes data for modular multiplication. See `mod_mul_precomputed` and
            /// [`mod_mul_precomputed_assign`](super::traits::ModMulPrecomputedAssign).
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// This is equivalent to `n_preinvert_limb` from `ulong_extras.h`, FLINT 2.7.1.
            </span><span class="kw">fn </span>precompute_mod_mul_data(<span class="kw-2">&amp;</span>m: <span class="kw-2">&amp;</span><span class="macro-nonterminal">$t</span>) -&gt; <span class="macro-nonterminal">$t </span>{
                <span class="macro-nonterminal">$invert_limb</span>(m &lt;&lt; LeadingZeros::leading_zeros(m))
            }

            <span class="doccomment">/// Multiplies two numbers modulo a third number $m$. The inputs must be already
            /// reduced modulo $m$.
            ///
            /// Some precomputed data is provided; this speeds up computations involving several
            /// modular multiplications with the same modulus. The precomputed data should be
            /// obtained using
            /// [`precompute_mod_mul_data`](ModMulPrecomputed::precompute_mod_mul_data).
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// # Panics
            /// Panics if `self` or `other` are greater than or equal to `m`.
            ///
            /// # Examples
            /// See [here](super::mod_mul#mod_mul_precomputed).
            ///
            /// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1.
            </span><span class="kw">fn </span>mod_mul_precomputed(<span class="self">self</span>, other: <span class="macro-nonterminal">$t</span>, m: <span class="macro-nonterminal">$t</span>, data: <span class="kw-2">&amp;</span><span class="macro-nonterminal">$t</span>) -&gt; <span class="macro-nonterminal">$t </span>{
                fast_mod_mul::&lt;<span class="macro-nonterminal">$t</span>, <span class="macro-nonterminal">$dt</span>&gt;(<span class="self">self</span>, other, m, <span class="kw-2">*</span>data)
            }
        }
    };
}
<span class="macro">impl_mod_mul_precomputed_fast!</span>(u32, u64, limbs_invert_limb_u32);
<span class="macro">impl_mod_mul_precomputed_fast!</span>(u64, u128, limbs_invert_limb_u64);

<span class="macro">macro_rules! </span>impl_mod_mul_precomputed_promoted {
    (<span class="macro-nonterminal">$t</span>:ident) =&gt; {
        <span class="kw">impl </span>ModMulPrecomputed&lt;<span class="macro-nonterminal">$t</span>, <span class="macro-nonterminal">$t</span>&gt; <span class="kw">for </span><span class="macro-nonterminal">$t </span>{
            <span class="kw">type </span>Output = <span class="macro-nonterminal">$t</span>;
            <span class="kw">type </span>Data = u32;

            <span class="doccomment">/// Precomputes data for modular multiplication. See `mod_mul_precomputed` and
            /// [`mod_mul_precomputed_assign`](super::traits::ModMulPrecomputedAssign).
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// This is equivalent to `n_preinvert_limb` from `ulong_extras.h`, FLINT 2.7.1.
            </span><span class="kw">fn </span>precompute_mod_mul_data(<span class="kw-2">&amp;</span>m: <span class="kw-2">&amp;</span><span class="macro-nonterminal">$t</span>) -&gt; u32 {
                u32::precompute_mod_mul_data(<span class="kw-2">&amp;</span>u32::from(m))
            }

            <span class="doccomment">/// Multiplies two numbers modulo a third number $m$. The inputs must be already
            /// reduced modulo $m$.
            ///
            /// Some precomputed data is provided; this speeds up computations involving several
            /// modular multiplications with the same modulus. The precomputed data should be
            /// obtained using
            /// [`precompute_mod_mul_data`](ModMulPrecomputed::precompute_mod_mul_data).
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// # Panics
            /// Panics if `self` or `other` are greater than or equal to `m`.
            ///
            /// # Examples
            /// See [here](super::mod_mul#mod_mul_precomputed).
            ///
            /// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1.
            </span><span class="kw">fn </span>mod_mul_precomputed(<span class="self">self</span>, other: <span class="macro-nonterminal">$t</span>, m: <span class="macro-nonterminal">$t</span>, data: <span class="kw-2">&amp;</span>u32) -&gt; <span class="macro-nonterminal">$t </span>{
                <span class="macro-nonterminal">$t::wrapping_from</span>(u32::from(<span class="self">self</span>).mod_mul_precomputed(
                    u32::from(other),
                    u32::from(m),
                    data,
                ))
            }
        }
    };
}
<span class="macro">impl_mod_mul_precomputed_promoted!</span>(u8);
<span class="macro">impl_mod_mul_precomputed_promoted!</span>(u16);

<span class="kw">impl </span>ModMulPrecomputed&lt;u128, u128&gt; <span class="kw">for </span>u128 {
    <span class="kw">type </span>Output = u128;
    <span class="kw">type </span>Data = ();

    <span class="doccomment">/// Precomputes data for modular multiplication. See `mod_mul_precomputed` and
    /// [`mod_mul_precomputed_assign`](super::traits::ModMulPrecomputedAssign).
    ///
    /// # Worst-case complexity
    /// Constant time and additional memory.
    </span><span class="kw">fn </span>precompute_mod_mul_data(_m: <span class="kw-2">&amp;</span>u128) {}

    <span class="doccomment">/// Multiplies two numbers modulo a third number $m$. The inputs must be already reduced modulo
    /// $m$.
    ///
    /// Some precomputed data is provided; this speeds up computations involving several modular
    /// multiplications with the same modulus. The precomputed data should be obtained using
    /// [`precompute_mod_mul_data`](ModMulPrecomputed::precompute_mod_mul_data).
    ///
    /// # Worst-case complexity
    /// Constant time and additional memory.
    ///
    /// # Panics
    /// Panics if `self` or `other` are greater than or equal to `m`.
    ///
    /// # Examples
    /// See [here](super::mod_mul#mod_mul_precomputed).
    ///
    /// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1.
    </span><span class="attr">#[inline]
    </span><span class="kw">fn </span>mod_mul_precomputed(<span class="self">self</span>, other: u128, m: u128, _data: <span class="kw-2">&amp;</span>()) -&gt; u128 {
        naive_mod_mul(<span class="self">self</span>, other, m)
    }
}

<span class="kw">impl </span>ModMulPrecomputed&lt;usize, usize&gt; <span class="kw">for </span>usize {
    <span class="kw">type </span>Output = usize;
    <span class="kw">type </span>Data = usize;

    <span class="doccomment">/// Precomputes data for modular multiplication. See `mod_mul_precomputed` and
    /// [`mod_mul_precomputed_assign`](super::traits::ModMulPrecomputedAssign).
    ///
    /// # Worst-case complexity
    /// Constant time and additional memory.
    ///
    /// This is equivalent to `n_preinvert_limb` from `ulong_extras.h`, FLINT 2.7.1.
    </span><span class="kw">fn </span>precompute_mod_mul_data(<span class="kw-2">&amp;</span>m: <span class="kw-2">&amp;</span>usize) -&gt; usize {
        <span class="kw">if </span>usize::WIDTH == u32::WIDTH {
            usize::wrapping_from(u32::precompute_mod_mul_data(<span class="kw-2">&amp;</span>u32::wrapping_from(m)))
        } <span class="kw">else </span>{
            usize::wrapping_from(u64::precompute_mod_mul_data(<span class="kw-2">&amp;</span>u64::wrapping_from(m)))
        }
    }

    <span class="doccomment">/// Multiplies two numbers modulo a third number $m$. The inputs must be already reduced modulo
    /// $m$.
    ///
    /// Some precomputed data is provided; this speeds up computations involving several modular
    /// multiplications with the same modulus. The precomputed data should be obtained using
    /// `precompute_mod_mul_data`.
    ///
    /// # Worst-case complexity
    /// Constant time and additional memory.
    ///
    /// # Panics
    /// Panics if `self` or `other` are greater than or equal to `m`.
    ///
    /// # Examples
    /// See [here](super::mod_mul#mod_mul_precomputed).
    ///
    /// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1.
    </span><span class="kw">fn </span>mod_mul_precomputed(<span class="self">self</span>, other: usize, m: usize, data: <span class="kw-2">&amp;</span>usize) -&gt; usize {
        <span class="kw">if </span>usize::WIDTH == u32::WIDTH {
            usize::wrapping_from(u32::wrapping_from(<span class="self">self</span>).mod_mul_precomputed(
                u32::wrapping_from(other),
                u32::wrapping_from(m),
                <span class="kw-2">&amp;</span>u32::wrapping_from(<span class="kw-2">*</span>data),
            ))
        } <span class="kw">else </span>{
            usize::wrapping_from(u64::wrapping_from(<span class="self">self</span>).mod_mul_precomputed(
                u64::wrapping_from(other),
                u64::wrapping_from(m),
                <span class="kw-2">&amp;</span>u64::wrapping_from(<span class="kw-2">*</span>data),
            ))
        }
    }
}

<span class="macro">macro_rules! </span>impl_mod_mul {
    (<span class="macro-nonterminal">$t</span>:ident) =&gt; {
        <span class="kw">impl </span>ModMulPrecomputedAssign&lt;<span class="macro-nonterminal">$t</span>, <span class="macro-nonterminal">$t</span>&gt; <span class="kw">for </span><span class="macro-nonterminal">$t </span>{
            <span class="doccomment">/// Multiplies two numbers modulo a third number $m$, in place. The inputs must be
            /// already reduced modulo $m$.
            ///
            /// Some precomputed data is provided; this speeds up computations involving several
            /// modular multiplications with the same modulus. The precomputed data should be
            /// obtained using
            /// [`precompute_mod_mul_data`](ModMulPrecomputed::precompute_mod_mul_data).
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// # Panics
            /// Panics if `self` or `other` are greater than or equal to `m`.
            ///
            /// # Examples
            /// See [here](super::mod_mul#mod_mul_precomputed_assign).
            ///
            /// This is equivalent to `n_mulmod2_preinv` from `ulong_extras.h`, FLINT 2.7.1, where
            /// the return value is assigned to `a`.
            </span><span class="attr">#[inline]
            </span><span class="kw">fn </span>mod_mul_precomputed_assign(<span class="kw-2">&amp;mut </span><span class="self">self</span>, other: <span class="macro-nonterminal">$t</span>, m: <span class="macro-nonterminal">$t</span>, data: <span class="kw-2">&amp;</span><span class="self">Self</span>::Data) {
                <span class="kw-2">*</span><span class="self">self </span>= <span class="self">self</span>.mod_mul_precomputed(other, m, data);
            }
        }

        <span class="kw">impl </span>ModMul&lt;<span class="macro-nonterminal">$t</span>&gt; <span class="kw">for </span><span class="macro-nonterminal">$t </span>{
            <span class="kw">type </span>Output = <span class="macro-nonterminal">$t</span>;

            <span class="doccomment">/// Multiplies two numbers modulo a third number $m$. The inputs must be already
            /// reduced modulo $m$.
            ///
            /// $f(x, y, m) = z$, where $x, y, z &lt; m$ and $xy \equiv z \mod m$.
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// # Panics
            /// Panics if `self` or `other` are greater than or equal to `m`.
            ///
            /// # Examples
            /// See [here](super::mod_mul#mod_mul).
            ///
            /// This is equivalent to `nmod_mul` from `nmod_vec.h`, FLINT 2.7.1.
            </span><span class="attr">#[inline]
            </span><span class="kw">fn </span>mod_mul(<span class="self">self</span>, other: <span class="macro-nonterminal">$t</span>, m: <span class="macro-nonterminal">$t</span>) -&gt; <span class="macro-nonterminal">$t </span>{
                naive_mod_mul(<span class="self">self</span>, other, m)
            }
        }

        <span class="kw">impl </span>ModMulAssign&lt;<span class="macro-nonterminal">$t</span>&gt; <span class="kw">for </span><span class="macro-nonterminal">$t </span>{
            <span class="doccomment">/// Multiplies two numbers modulo a third number $m$, in place. The inputs must be
            /// already reduced modulo $m$.
            ///
            /// $x \gets z$, where $x, y, z &lt; m$ and $xy \equiv z \mod m$.
            ///
            /// # Worst-case complexity
            /// Constant time and additional memory.
            ///
            /// # Examples
            /// See [here](super::mod_mul#mod_mul_assign).
            ///
            /// # Panics
            /// Panics if `self` or `other` are greater than or equal to `m`.
            ///
            /// This is equivalent to `nmod_mul` from `nmod_vec.h`, FLINT 2.7.1, where the result
            /// is assigned to `a`.
            </span><span class="attr">#[inline]
            </span><span class="kw">fn </span>mod_mul_assign(<span class="kw-2">&amp;mut </span><span class="self">self</span>, other: <span class="macro-nonterminal">$t</span>, m: <span class="macro-nonterminal">$t</span>) {
                <span class="kw-2">*</span><span class="self">self </span>= naive_mod_mul(<span class="kw-2">*</span><span class="self">self</span>, other, m);
            }
        }
    };
}
<span class="macro">apply_to_unsigneds!</span>(impl_mod_mul);
</code></pre></div></section></main></body></html>